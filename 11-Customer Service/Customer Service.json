{
  "name": "My workflow 3",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -80,
        0
      ],
      "id": "71250bc6-99bc-43d8-8f9e-19fd53270bb8",
      "name": "When chat message received",
      "webhookId": "9cd4e7b4-f0e4-42fe-92d1-017456f4bf35"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=# Role\nYou are an AI-powered customer support agent for a business. Your name is 'Dhafir'. Your task is to accurately assess customer issues, determine the correct department to handle the problem, and send an email to that department's contact person. You also log the history of all tickets.\n\n# Behavior\nYou are professional, courteous, and efficient. You respond to customer inquiries by first asking for their full name and a detailed description of their issue. Once you have this information, you classify the problem, generate a unique ticket number, and log the issue with the following details: Issue, Customer Name, Customer Email, Ticket Number, and Department. Finally, you use your tools to send an email to the appropriate department. You are concise and provide clear instructions.\n\n# Time and Date: {{ $now }}\n\n# Tools\nYou have access to multiple tools and always use the appropriate one depending on the task.\n\n## Departments\nUse this tool to retrieve the email address for a specific department. The sheet contains the following departments:\n\n* Finance Department: Handles issues related to payments, funds, and financial processes.\n\n* IT Department: Handles technical issues like password failures or login problems.\n\n* Delivery Department: Handles issues with wrong or missing delivered items.\n\n* Admin Department: Handles general business-related issues.\n\n# Send a message in Gmail\nUse this tool to send an email to the relevant department. The email should include the customer's full name, a description of their issue, and the unique ticket number.\n\n## History\nUse this tool to log each ticket's history. The logged information must include the Issue, Customer Name, Customer Email, Ticket Number, and the Department assigned to the ticket. The Ticket Number must be unique for each issue. always ask about the name, email of the customer."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        208,
        0
      ],
      "id": "3c3af11c-b849-4478-92d5-a48dda5e1a4f",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        80,
        208
      ],
      "id": "131a17f5-bf5a-4aa9-95ba-7b131e332705",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "YOUR_CREDENTIALS",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        224,
        208
      ],
      "id": "cd65a51d-ea44-4b34-8379-21d37e8f1c81",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "sendTo": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        592,
        192
      ],
      "id": "692209b3-0b1b-4eae-ad1d-a1032505537d",
      "name": "Send a message in Gmail",
      "webhookId": "adb8a27e-2daf-48d9-976d-5339277a25b4",
      "credentials": {
        "gmailOAuth2": {
          "id": "YOUR_CREDENTIALS",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ydB-zklccv0_vtk4TLjlFc5cwB3v3-UIBJU9lleVxZA",
          "mode": "list",
          "cachedResultName": "Organization Departments",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ydB-zklccv0_vtk4TLjlFc5cwB3v3-UIBJU9lleVxZA/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ydB-zklccv0_vtk4TLjlFc5cwB3v3-UIBJU9lleVxZA/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        368,
        224
      ],
      "id": "54ca067e-63d0-49a8-8476-d59b48c5557a",
      "name": "Departments",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_CREDENTIALS",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1ydB-zklccv0_vtk4TLjlFc5cwB3v3-UIBJU9lleVxZA",
          "mode": "list",
          "cachedResultName": "Organization Departments",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ydB-zklccv0_vtk4TLjlFc5cwB3v3-UIBJU9lleVxZA/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1273600018,
          "mode": "list",
          "cachedResultName": "Sheet2",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ydB-zklccv0_vtk4TLjlFc5cwB3v3-UIBJU9lleVxZA/edit#gid=1273600018"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Issue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Issue', ``, 'string') }}",
            "Customer Name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Customer_Name', ``, 'string') }}",
            "Customer Email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Customer_Email', ``, 'string') }}",
            "Ticket Number": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Ticket_Number', ``, 'string') }}",
            "Deprtment ": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Deprtment_', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Issue",
              "displayName": "Issue",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Customer Name",
              "displayName": "Customer Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Customer Email",
              "displayName": "Customer Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Ticket Number",
              "displayName": "Ticket Number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Deprtment ",
              "displayName": "Deprtment ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        464,
        208
      ],
      "id": "4a113626-7f56-4a3d-9438-7f041616658c",
      "name": "History",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_CREDENTIALS",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        []
      ]
    },
    "Send a message in Gmail": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Departments": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "History": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "f49bd8df-c20f-429e-84a2-7fda43283588",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "d582c6d9abbb88f361ce5586df1bb470a0ec28834901a8c3ab1164fc8a54753e"
  },
  "id": "5JLNQwRvxUnuiw5J",
  "tags": []
}
